{% extends "/layout/plantilla.html" %}
{% block content %}

{{ toastr.include_toastr_js() }}

<div class="overflow-auto">
    <div class="container mt-4">
        <div class="row">
            <div class="col-12">
                <table class="table table-resposive text-center">
                    <thead>
                        <tr class="table-dark">
                            <th scope="col">Paciente</th>
                            <th scope="col">Sexo</th>
                            <th scope="col">Cedula</th>
                            <th scope="col">Nro. de Expediente</th>
                            <th scope="col">Cama/Cubiculo</th>
                            <th scope="col">Fecha</th>
                            <th scope="col">Hora</th>
                            <th scope="col">Editar</th>
                            <th scope="col">Exportar</th>
                            <th scope="col">Eliminar</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for historia in historias %}
                        <tr>
                            <td>
                                {{ historia['registro_paciente']['nombres'] +" "+ historia['registro_paciente']['apellidos']  }}
                            </td>
                            <td>
                                {{ historia['registro_paciente']['sexo'] }}
                            </td>
                            <td>
                                {{ historia['registro_paciente']['cedula'] }}
                            </td>
                            <td>
                                {{ historia['historia_clinica']['nro_expediente'] }}
                            </td>
                            <td>
                                {{ historia['historia_clinica']['cama_cubiculo'] }}
                            </td>
                            <td>
                                {{ historia['historia_clinica']['fecha'] }}
                            </td>
                            <td>
                                {{ historia['historia_clinica']['hora'] }}
                            </td>
                            <td>
                                <button type="button" class="btn btn-info" data-bs-toggle="modal"
                                    data-bs-target="#historiaEditar" data-id="{{ historia['_id'] }}"><i
                                        class="fas fa-edit"></i>
                                </button>
                            </td>
                            <td>
                                <button type="button" class="btn btn-warning" data-bs-toggle="modal"
                                    data-bs-target="#historiaExportar" data-id="{{ historia['_id'] }}"><i
                                        class="fas fa-download"></i>
                                </button>
                                <script>
                                    document.querySelectorAll('.btn-warning').forEach(button => {
                                        button.addEventListener('click', () => {
                                            const id = button.getAttribute('data-id');
                                            window.location.href = `/exportar_historia_clinica?id_historia=${id}`;
                                        });
                                    });
                                    </script>
                            </td>
                            <td>
                                <button type="button" class="btn btn-danger" data-bs-toggle="modal"
                                    data-bs-target="#historiaEliminar" data-id="{{ historia['_id'] }}"><i
                                        class="fas fa-trash-alt"></i>
                                </button>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="historiaEliminar" tabindex="-1" aria-labelledby="eliminarLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-3" id="eliminarLabel">Eliminar Historia Cl√≠nica</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form action="/eliminiar_historia" method="post">
                <div class="modal-body">
                    <input type="hidden" id="id_historia_clinica" name="name_eliminar_historia">
                    <div class="modal-body fs-5 text-center" id="info_eliminar">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                    <button type="submit" class="btn btn-danger">Confirmar</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script src="{{ url_for('static', filename='js/crud.js') }}"></script>

{% endblock %}